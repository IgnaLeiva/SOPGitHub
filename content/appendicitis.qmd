---
title: "Appendicitis"
---
```{r warning=FALSE, message=FALSE, echo= FALSE}
library(tidyverse)
library(here)
```


## How to run Syntea

For making some tries I use the _Appendecitis_ module.
However, since it is complicated to comparate the proportions inserted in the module with the simulated values, I simplified the JSON file.
This is located in the `synthea/src/main/resources/modules`, it is called appe5.json

Modules are in `~/synthea/src/main/resources/modules`.

# This is appendicitis case 

Using this run `./run_synthea -p 10000 -m appe5 --exporter.csv.export=true -- exporter.fhir.export=false --exporter.years_of_history=0`.

The module `appe5` is in `Modules` file

## Load data

Data will be stored in `~/synthea/output/csv`

```{r message= FALSE, warning=FALSE, eval=TRUE}
# WD
setwd(here::here("data/appendicitis"))


# Get the name of the files 

files <- list.files(path=".", pattern = ".csv", full.names=FALSE)
filenames <- tools::file_path_sans_ext(basename(files))

# Get the data
data <- lapply(files, readr::read_csv)
names(data) <- filenames


# get the field name of each table
# names <- data.frame(file = NA, var = NA)
# for(i in 1:length(data)){
#   x <- data.frame(file =names(data)[i],
#                   var = paste0(colnames(data[[i]]), collapse = ", "))
#   names <- rbind(names, x)
# }

observations <- data$observations
patients <- data$patients
conditions <- data$conditions
procedures <- data$procedures
encounters <- data$encounters

```

### Data preparation

```{r eval=TRUE}

data$patients %>% 
  rename(PATIENT = Id) %>% 
  left_join(data$conditions, by = "PATIENT") %>% 
  mutate(age_diag = lubridate::time_length(difftime(START, BIRTHDATE), "years"),
         appendicitis = ifelse(CODE == 74400008, 1, 0)) %>% 
  group_by(GENDER) %>% 
  summarise(total_gender = n(),
            cases = sum(appendicitis, na.rm = TRUE),
            prev = (cases/total_gender)*100)
  

```


This matches with the module percentage, Male `8.6%`, Female `6.7%` 
