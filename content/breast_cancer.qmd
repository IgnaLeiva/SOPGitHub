---
title: "Breast Cancer"
---
```{r warning=FALSE, message=FALSE, echo= FALSE}
library(tidyverse, quietly = TRUE)
library(here)
```


## How to run Syntea

Modules are in `~/synthea/src/main/resources/modules`.

# This is appendicitis case 

Using this run `./run_synthea -p 10000 -m breast_cacer_example --exporter.csv.export=true -- exporter.fhir.export=false --exporter.years_of_history=0`.

The module `breast_cacer_example` is in `Modules` file

**We need this information**

 - Prevalence of BC by Sex
 - Prevalence by Age
 - Delay, survival rate ideally confidence intervals


## Load data

Data will be stored in `~/synthea/output/csv`

Move this data to the `data` folder

```{r message= FALSE, warning=FALSE, eval=TRUE}
# WD
setwd(here::here("data/breast_cancer_gender"))


# Get the name of the files 

files <- list.files(path=".", pattern = ".csv", full.names=FALSE)
filenames <- tools::file_path_sans_ext(basename(files))

# Get the data
data <- lapply(files, readr::read_csv)
names(data) <- filenames


# get the field name of each table
# names <- data.frame(file = NA, var = NA)
# for(i in 1:length(data)){
#   x <- data.frame(file =names(data)[i],
#                   var = paste0(colnames(data[[i]]), collapse = ", "))
#   names <- rbind(names, x)
# }

observations <- data$observations
patients <- data$patients
conditions <- data$conditions
procedures <- data$procedures
encounters <- data$encounters

```

### Data preparation

```{r eval=TRUE}

data$patients %>% 
  rename(PATIENT = Id) %>% 
  left_join(data$conditions, by = "PATIENT") %>% 
  mutate(age_diag = lubridate::time_length(difftime(START, BIRTHDATE), "years"),
         appendicitis = ifelse(CODE == 254837009, 1, 0)) %>% 
  group_by(GENDER) %>% 
  summarise(total_gender = n(),
            cases = sum(appendicitis, na.rm = TRUE),
            prev = (cases/total_gender)*100)
  

```


This matches with the module percentage, Male `13%`, Female `0.1%` 
